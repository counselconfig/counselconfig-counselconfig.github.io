<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><div style = "position:absolute; left:460px; top:70px;"><h1 style="font-family:Calibri Light; color:Grey; font-size: 25px;">counsel.config<sup style="font-size:20%">TM</sup>&nbsp</h1></div><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Amazon Web Services topology" /><meta property="og:locale" content="en_US" /><meta name="description" content="Use case" /><meta property="og:description" content="Use case" /><link rel="canonical" href="http://localhost:4000/2021/06/21/aws-toplogy" /><meta property="og:url" content="http://localhost:4000/2021/06/21/aws-toplogy" /><meta property="og:site_name" content="counsel.config" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-21T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Amazon Web Services topology" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@type":"BlogPosting","url":"http://localhost:4000/2021/06/21/aws-toplogy","headline":"Amazon Web Services topology","dateModified":"2021-06-21T00:00:00+01:00","datePublished":"2021-06-21T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/06/21/aws-toplogy"},"description":"Use case","@context":"https://schema.org"}</script><title> Amazon Web Services topology - counsel.config</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="counsel.config" href="/atom.xml"><link rel="alternate" type="application/json" title="counsel.config" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:10rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}.highlight{background:#fff}.highlighter-rouge .highlight{background:#eef}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:#008080}.highlight .nb{color:#0086B3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:#008080}.highlight .ni{color:#800080}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:#000080}.highlight .nv{color:#008080}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:#008080}.highlight .vg{color:#008080}.highlight .vi{color:#008080}.highlight .il{color:#099}pre,code{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:auto}pre>code{border:0;padding-right:0;padding-left:0}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}table{margin-bottom:30px;width:100%;text-align:left;color:#3f3f3f;border-collapse:collapse;border:1px solid #e8e8e8}table tr:nth-child(even){background-color:#f7f7f7}table th,table td{padding:10px 15px}table th{background-color:#f0f0f0;border:1px solid #dedede;border-bottom-color:#c9c9c9}table td{border:1px solid #e8e8e8}</style></head><head><link rel="stylesheet" type="text/css" href="/_sass/_main.css"></head><body><main role="main"><header role="banner"> <!--<h1 class="logo">counsel.config</h1>--><nav role="navigation"><ul><li><a href="/" >Index</a></li><li><a href="/about" >About</a></li><li><a href="/search" >Search</a></li><li><a href="https://github.com/counselconfig" >Git</a></li><li><a href="/atom.xml" >Rss</a></li></ul></nav></header><section class="post"><h2>Amazon Web Services topology</h2><h3 id="use-case">Use case</h3><p>I dealt with a client, an SME print company called PrintIT wanting a solution to harness its expansive sales via improved infrastructure and, eventually, geographically with different offices to off-load parts of its workflow. <br /> <br /></p><embed src="/assets/images/exisitingarch.svg" width="50%" height="50%" style="display: block; margin: 0 auto" /><p><br /></p><center><i>Figure 1 Exisiting physical architecture</i></center><h3 id="proposed-aws-architecture">Proposed AWS architecture</h3><p>Advice given was that PrintIT should replatform as a migration strategy with the possibility for hybrid migration retention on some components like the exchange server. As an SME, PrintIT should be guided by a stepwise framework for migration along the lines of Khan and Al-Yasiri (2015)<sup id="fnref:fn1" role="doc-noteref"><a href="#fn:fn1" class="footnote" rel="footnote">1</a></sup>, which involves: ‘requirements’ – market study, and a likely choice of IaaS; ‘preparation’ – including a feasibility study, readiness questionnaire, and close looks at risks; and, ‘migration – assessing costs and contracts, testing deployments, and monitoring.</p><p><br /></p><embed src="/assets/images/propawstopology.svg" /><p><em>Figure 2 VPC topology</em></p><h3 id="configuration-setup">Configuration setup</h3><p>To provision a new bespoke VPC for our client PrintIT, IAM is required with a root account for business should be set up. A new user ‘principal’ should be created and added to a new group associated with the Administrator Access policy document à la:</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>Mapping the problem domain to AWS offerings was carried out under the Rabetski (2011)<sup id="fnref:fn1:1" role="doc-noteref"><a href="#fn:fn1" class="footnote" rel="footnote">1</a></sup> process.</p><p><br /></p><h3 id="vpc">VPC</h3><p>A VPC is a service listed in the AWS Management Console which when selected can be initiated with a setup assistant interface via ‘Launch VPC Wizard’. It will exist alongside the default VPC:</p><p><br /> <img src="/assets/images/defaultvpc.svg" alt="defaultvpc." title="Defaulat VPC" /> <em>Figure 3 Default VPC</em></p><p>The VPC is configured with ‘Public and Private Subnets’ at Step 1 which creates a /16 network with two /24 subnets. The private subnet cannot reach the internet through a NAT and the public subnets access it using elastic IP’s.</p><p><br /></p><h3 id="subnets">Subnets</h3><p>Subnets by way of exmaplt could be AZ us-east-1a and 1b US East (N. Virginia) but in production, PrintIT should likely use local region eu-west2, EU (London) to reduce latency. VPC User Guide (2020) recommends a maximum CIDR block ./16 from private IPv4 meaning 10.0.0.0 - 10.255.255.255 (10/8 prefix) is used: RFC 1918 (Rekhter, et al.)<sup id="fnref:fn3" role="doc-noteref"><a href="#fn:fn3" class="footnote" rel="footnote">2</a></sup>. The NAT gateway was given a public elastic IP with an ID. Additional public and private subnets are created in AZ ‘b’. Two pairs of private and public subnets provide high availability across multiple AZs promoted by the Reliability Pillar of the AWS Well-Architected Framework (Piper &amp; Clinton, 2019, p. 191)<sup id="fnref:fn4" role="doc-noteref"><a href="#fn:fn4" class="footnote" rel="footnote">3</a></sup>. As the VPC Wizard creates only one NAT gateway for Public Subnet 1, a second was created.</p><p><br /></p><embed src="/assets/images/subnets.svg" /><p><em>Figure 4 Created subnets</em></p><p><br /></p><h3 id="routing">Routing</h3><p>The NAT gateways send packets to the internet which requires the private and public subnets to be configured to route internet bound traffic to them using an associated route table. <br /><br /></p><embed src="/assets/images/vpcsubnets.svg" style="display: block; margin: 0 auto" /> <center><i>Figure 5 VPC with Public and Private Subnets in Two AZ’s</i></center><p><em>Table 1 Routes for Private and Public Subnets</em></p><style> table, th, td { border:1px solid black; border-collapse: collapse; }</style><table><tr><th>Subnets</th><th>Destination</th><th>Target</th></tr><tr><td>Public</td><td>10.0.0.0/16</td><td>Local</td></tr><tr><td>Public</td><td>0.0.0.0/0</td><td>Internet Gateway</td></tr><tr><td>Private</td><td>10.0.0.0/16</td><td>Localy</td></tr><tr><td>Private</td><td>0.0.0.0/0</td><td>NAT Gateway</td></tr></table><p><br /></p><h3 id="security-groups-ec2-instances-and-rds-db-instances">Security groups, EC2 instances, and RDS DB instances</h3><p>A ‘security group’ was created to behave as a stateful firewall on the EC2 instances as web servers to regulate port access, IP authorised ranges, inbound, and outbound network traffic. Then a ‘Dedicated’ Windows Server OS was used to launch and eventually host IIS as a web server. Next an AMI was created and stored in the Print IT VPC and the instance is deleted from the public subnet as production will use AMIs in private subnets. For the database, a security group was created to allow packets from the Web Security Group. A database subnet group was configured to instruct the forthcoming RDS what subnets to utilise. A MS SQL database was chosen - data from PrintIT’s Access database can undergo ETL after its instantiation. The option for logging performance information for CloudWatch was selected too. The RDS instance was also replicated for Multi-AZ deployment to be highly available under production loads.</p><p><br /></p><embed src="/assets/images/deployedrds.svg" width="50%" height="50%" style="display: block; margin: 0 auto" /> <center><i>Figure 6 Deployed RDS</i></center><p><br /></p><h3 id="load-balancing-and-scaling">Load balancing and scaling</h3><p>A load balancer was created to spread traffic across AZs and the EC2 instances that will be launched into private subnets with the database servers, routing requests to targets using HTTP port 80. Next, Auto Scaling, which comprises a Launch Configuration, Auto Scaling group, and non-compulsory scaling policy. AMI Web Server 1 could be used to launch the configuration - the autoscaling group was set to start with two instances in Private Subnet 1 (10.0.1.0/24) and Private Subnet 2 (10.0.3.0/24). As regards scaling policies, for the EC2’s, Print IT may be given a scale between two and six instances with average CPU use at 60.</p><p>an opportunity also exists to attach EBS root volumes to the Windows ECS instances to store the image files and to take routine snapshots of them as backups. They will be replicated automatically within its AZ for durability ideally as General Purpose SSD and can be provisioned with the following CloudFormation in a comparable manner as in the code below</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">Resources</span><span class="pi">:</span>
  <span class="pi">[</span><span class="nv">...</span><span class="pi">]</span>
  <span class="na">EBSBackupVolumeA</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s1">'</span><span class="s">AWS::EC2::Volume'</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">AvailabilityZone</span><span class="pi">:</span> <span class="kt">!Select</span> <span class="pi">[</span><span class="nv">0</span><span class="pi">,</span> <span class="kt">!GetAZs</span> <span class="s1">'</span><span class="s">'</span><span class="pi">]</span>
      <span class="na">Size</span><span class="pi">:</span> <span class="m">5</span>
      <span class="na">VolumeType</span><span class="pi">:</span> <span class="s">gp2</span>
<span class="na">EBSBackupVolumeAttachmentA</span><span class="pi">:</span>
  <span class="na">Type</span><span class="pi">:</span> <span class="s1">'</span><span class="s">AWS::EC2::VolumeAttachment'</span>
  <span class="na">Properties</span><span class="pi">:</span>
    <span class="na">Device</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/dev/xvdf'</span>
    <span class="na">InstanceId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">EC2InstanceA</span>
    <span class="na">VolumeId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">EBSBackupVolumeA</span>
</code></pre></div></div><div class="footnotes" role="doc-endnotes"><ol><li id="fn:fn1" role="doc-endnote"><p>Khan and Al-Yasiri, 2015. Framework for cloud computing adoption: A road map for Smes to cloud migration, International Journal on Cloud Computing: Services and Architecture (IJCCSA) Vol. 5, No. 5/6 <a href="#fnref:fn1" class="reversefootnote" role="doc-backlink">&#8617;</a> <a href="#fnref:fn1:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a></p></li><li id="fn:fn3" role="doc-endnote"><p>Rekhter, Y. et al., February 1996. RFC 1918: Address Allocation for Private Internets, s.l.: Network Working Group IETF <a href="#fnref:fn3" class="reversefootnote" role="doc-backlink">&#8617;</a></p></li><li id="fn:fn4" role="doc-endnote"><p>Piper, B. &amp; Clinton, D., 2019. AWS Certified Solutions Architect Study Guide: Associate SAA-C01 Exam. Second ed. Indianapolis: John Wiley &amp; Sons. <a href="#fnref:fn4" class="reversefootnote" role="doc-backlink">&#8617;</a></p></li></ol></div><span class="meta"><time datetime="2021-06-21T00:00:00+01:00">21 June 2021</time> &middot; <a href="/tag/AWS">AWS</a>, <a href="/tag/vpc">vpc</a>, <a href="/tag/subnet">subnet</a></span></section></main></body></html>
