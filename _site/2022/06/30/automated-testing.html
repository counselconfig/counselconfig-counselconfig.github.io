<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><div style = "position:absolute; left:460px; top:70px;"><h1 style="font-family:Calibri Light; color:Grey; font-size: 25px;">counsel.config<sup style="font-size:20%">TM</sup>&nbsp</h1></div><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Automated unit testing" /><meta property="og:locale" content="en_US" /><meta name="description" content="Python unit testing a web application inside of Django." /><meta property="og:description" content="Python unit testing a web application inside of Django." /><link rel="canonical" href="http://localhost:4000/2022/06/30/automated-testing" /><meta property="og:url" content="http://localhost:4000/2022/06/30/automated-testing" /><meta property="og:site_name" content="counsel.config" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-30T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Automated unit testing" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"dateModified":"2022-06-30T00:00:00+01:00","@type":"BlogPosting","url":"http://localhost:4000/2022/06/30/automated-testing","description":"Python unit testing a web application inside of Django.","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022/06/30/automated-testing"},"headline":"Automated unit testing","datePublished":"2022-06-30T00:00:00+01:00","@context":"https://schema.org"}</script><title> Automated unit testing - counsel.config</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="counsel.config" href="/atom.xml"><link rel="alternate" type="application/json" title="counsel.config" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:10rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}.highlight{background:#fff}.highlighter-rouge .highlight{background:#eef}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:#008080}.highlight .nb{color:#0086B3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:#008080}.highlight .ni{color:#800080}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:#000080}.highlight .nv{color:#008080}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:#008080}.highlight .vg{color:#008080}.highlight .vi{color:#008080}.highlight .il{color:#099}pre,code{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:auto}pre>code{border:0;padding-right:0;padding-left:0}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}table{margin-bottom:30px;width:100%;text-align:left;color:#3f3f3f;border-collapse:collapse;border:1px solid #e8e8e8}table tr:nth-child(even){background-color:#f7f7f7}table th,table td{padding:10px 15px}table th{background-color:#f0f0f0;border:1px solid #dedede;border-bottom-color:#c9c9c9}table td{border:1px solid #e8e8e8}</style></head><head><link rel="stylesheet" type="text/css" href="/_sass/_main.css"></head><body><main role="main"><header role="banner"> <!--<h1 class="logo">counsel.config</h1>--><nav role="navigation"><ul><li><a href="/" >Index</a></li><li><a href="/about" >About</a></li><li><a href="/search" >Search</a></li><li><a href="https://github.com/counselconfig" >Git</a></li><li><a href="/atom.xml" >Rss</a></li></ul></nav></header><section class="post"><h2>Automated unit testing</h2><h1 id="python-unit-testing-a-web-application-inside-of-django">Python unit testing a web application inside of Django.</h1><p>The objective here is to check that the following urls from urls.py return as expected. Django detects tests by looking for classes that also starts with ‘test’, hence the list on the right in the test folder:</p><style> img { border: 1px solid #555; }</style><p><img src="/assets/images/unit_testing.png" alt="Award" width="100%" height="100%" /></p><p>N.B delete the test.py file Django automatically adds</p><p>I map all files to be tested to testing files - Django then looks for functions withinth the test classes. Here I am checking to see that my unit test virtual environment works, so I will intentionally fail a unit test:</p><div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span><span class="p">,</span> <span class="n">resolve</span> 
<span class="kn">from</span> <span class="nn">budget.views</span> <span class="kn">import</span> <span class="n">project_list</span><span class="p">,</span> <span class="n">project_detail</span><span class="p">,</span> <span class="n">ProjectCreateView</span>


<span class="k">class</span> <span class="nc">TestCheck</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_the_testsetup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#assert 1 == 2 # returns     assert 1 == 2 AssertionError
</span>
</code></pre></div></div><p>The <code class="highlighter-rouge">self.assertEquals()</code> verifies that the action of the function under test behaves as expected i.e. two arguments passed are equal. I am obtaining these results from my terminal like this:</p><p><img src="/assets/images/unit_testing_terminal.png" alt="Award" width="100%" height="100%" /></p><p>I am setting the URL now equal to the reverse of <code class="highlighter-rouge">'list'</code> - used to pass the url to the result function to what view Django is going to call.</p><div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TestUrls</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">list_resolves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'list'</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">resolve</span><span class="p">(</span><span class="n">url</span><span class="p">))</span> <span class="c1">#use resolve function to pass the url
</span>
        <span class="s">"""
        Creating test database for alias 'default'...
        System check identified no issues (0 silenced).
        ResolverMatch(func=budget.views.project_list, args=(), kwargs={}, url_name=list, app_names=[], namespaces=[])
        .
        ----------------------------------------------------------------------
        Ran 1 test in 0.007s

        OK
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">resolve</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">project_list</span><span class="p">)</span>

        <span class="s">"""
        ----------------------------------------------------------------------
        Ran 1 test in 0.008s

        OK
        """</span>
</code></pre></div></div><p>Next we test the <code class="highlighter-rouge">add</code> url:</p><div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="k">def</span> <span class="nf">add_resolves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'add'</span><span class="p">)</span>
        <span class="c1">#self.assertEquals(resolve(url).func, ProjectCreateView) # ProjectCreateView is a class based view so throws an error below
</span>        <span class="s">"""
        ======================================================================
        FAIL: test_list_url_is_resolved (tests.test_urls.TestUrls)
        ----------------------------------------------------------------------
        Traceback (most recent call last):
        File "F:</span><span class="err">\</span><span class="s">Dominic</span><span class="err">\</span><span class="s">Python</span><span class="err">\</span><span class="s">django-testing-dslove</span><span class="err">\</span><span class="s">django-testing-dslove</span><span class="se">\b</span><span class="s">udgetproject</span><span class="se">\b</span><span class="s">udget</span><span class="se">\t</span><span class="s">ests</span><span class="se">\t</span><span class="s">est_urls.py", line 48, in test_list_url_is_resolved
            self.assertEquals(resolve(url).func, ProjectCreateView)
        AssertionError: &lt;function ProjectCreateView at 0x0000023CFBE7EDC8&gt; != &lt;class 'budget.views.ProjectCreateView'&gt;

        ----------------------------------------------------------------------
        Ran 1 test in 0.008s

        FAILED (failures=1)
        Destroying test database for alias 'default'...
</span></code></pre></div></div><p>This association error is correct since the function of ProjectCreateView is not equal to the class. This is because the view is class based so we can add <code class="highlighter-rouge">func.view_class</code> to resolve the error</p><div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">resolve</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">view_class</span><span class="p">,</span> <span class="n">ProjectCreateView</span><span class="p">)</span>
        
        <span class="s">"""
        ----------------------------------------------------------------------
        Ran 1 test in 0.005s

        OK
        Destroying test database for alias 'default'...
        """</span>
</code></pre></div></div><p>An error that there is no reverse for details without any arguemnts if <code class="highlighter-rouge">args</code> is not used to equal some <code class="highlighter-rouge">slug</code> in the following test function because the URL definition above needs one:</p><div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">detail_resolves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'detail'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s">'a-slug'</span><span class="p">])</span> <span class="c1"># args included as url definition uses a slug
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">resolve</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">project_detail</span><span class="p">)</span> 
        
        <span class="s">"""
         ----------------------------------------------------------------------
        Ran 1 test in 0.007s

        OK
        Destroying test database for alias 'default'...
        """</span>
</code></pre></div></div><span class="meta"><time datetime="2022-06-30T00:00:00+01:00">30 June 2022</time> &middot; <a href="/tag/Python">Python</a>, <a href="/tag/Django">Django</a>, <a href="/tag/testing">testing</a></span></section></main></body></html>
